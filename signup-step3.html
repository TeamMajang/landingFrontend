<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>majangdeal</title>
  <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet">
  <link href="https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      border: none !important;
      background-color: #ffffff;
      font-family: 'Inter', sans-serif;
      overflow-y: auto;
      scrollbar-gutter: stable; /* 스크롤바 공간을 항상 예약하여 레이아웃 시프트 방지 */
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .signup-main-content {
      width: 100%;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background-color: #ffffff;
      padding: 80px 20px 40px 20px;
    }
    
    .signup-container {
      width: 480px;
      min-height: 865px;
      background-color: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 48px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      box-sizing: border-box;
    }
    
    .signup-header-section {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    .signup-progress {
      display: flex;
      flex-direction: row;
      gap: 8px;
      align-items: center;
      height: 8px;
    }
    
    .signup-step {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #e2e8f0;
    }
    
    .signup-step-1 {
      background-color: #10b981;
    }
    
    .signup-step-2 {
      background-color: #10b981;
    }
    
    .signup-step-3 {
      background-color: #3b82f6;
    }
    
    .signup-title {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      font-size: 28px;
      line-height: 33.6px;
      color: #1e293b;
      margin: 0;
    }
    
    .signup-description {
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 20px;
      line-height: 24px;
      color: #6b7280;
      margin: 0;
    }
    
    .signup-form-section {
      display: flex;
      flex-direction: column;
      gap: 24px;
      flex: 1;
    }
    
    .signup-input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      position: relative;
    }
    
    .password-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .password-toggle-button {
      position: absolute;
      right: 16px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      color: #9ca3af;
    }
    
    .password-toggle-button:hover {
      color: #6b7280;
    }
    
    .signup-label-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
    }
    
    .signup-label {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 14px;
      line-height: 16.8px;
      color: #374151;
      margin: 0;
    }
    
    .signup-verify-button {
      background-color: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 12px;
      line-height: 14.4px;
      color: #6b7280;
      transition: background-color 0.2s, border-color 0.2s, color 0.2s;
    }
    
    .signup-verify-button:hover {
      background-color: #e5e7eb;
    }
    
    .signup-verify-button.active {
      background-color: #3b82f6;
      border-color: #3b82f6;
      color: #ffffff;
    }
    
    .signup-verify-button.active:hover {
      background-color: #2563eb;
    }
    
    .signup-verify-button.verified {
      background-color: transparent;
      border: none;
      padding: 8px 12px;
      cursor: default;
      display: flex;
      align-items: center;
      gap: 4px;
      min-width: 69px;
      height: 32px;
      box-sizing: border-box;
    }
    
    .signup-verify-button.verified .verify-check-icon {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .signup-verify-button.verified .verify-text {
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 12px;
      line-height: 14.4px;
      color: #3b82f6;
    }
    
    .signup-input {
      width: 100%;
      height: 48px;
      background-color: #ffffff;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 0 16px;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
      font-size: 16px;
      line-height: 19.2px;
      color: #111827;
      box-sizing: border-box;
    }
    
    .password-input-wrapper .signup-input {
      padding-right: 48px;
    }
    
    .signup-input::placeholder {
      color: #9ca3af;
    }
    
    .signup-input:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    #phone-input:focus {
      outline: none;
      border-color: #d1d5db;
      background-color: #ffffff;
    }
    
    .signup-input.verified {
      background-color: #f3f4f6;
      border-color: #d1d5db;
      color: #6b7280;
      cursor: not-allowed;
    }
    
    .signup-input.verified:focus {
      outline: none;
      border-color: #d1d5db;
    }
    
    .signup-error-message {
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 14px;
      line-height: 16.8px;
      color: #dc2626;
      margin: 0;
      height: 16.8px;
      min-height: 16.8px;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .signup-error-message.visible {
      visibility: visible;
      opacity: 1;
    }
    
    .phone-verification-code-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }
    
    .phone-verification-timer-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
      height: 18px;
    }
    
    .phone-verification-timer {
      font-family: 'Spoqa Han Sans Neo', 'Inter', sans-serif;
      font-weight: 500;
      font-size: 14px;
      line-height: 17.528px;
      color: #6b7280;
    }
    
    .phone-verification-resend {
      font-family: 'Spoqa Han Sans Neo', 'Inter', sans-serif;
      font-weight: 500;
      font-size: 14px;
      line-height: 17.528px;
      color: #6b7280;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      text-decoration: none;
    }
    
    .phone-verification-resend:hover {
      text-decoration: underline;
    }
    
    .signup-submit-button {
      width: 100%;
      height: 56px;
      background-color: #9ca3af;
      border-radius: 8px;
      border: none;
      cursor: not-allowed;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 16px;
      line-height: 19.2px;
      color: #ffffff;
      margin-top: 24px;
    }
    
    .signup-submit-button:not(:disabled) {
      background-color: #3b82f6;
      cursor: pointer;
    }
    
    .signup-submit-button:disabled {
      cursor: not-allowed;
    }
    
    .signup-footer-section {
      width: 100%;
      background-color: #f8fafc;
      padding: 40px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }
    
    .signup-footer-links {
      display: flex;
      flex-direction: row;
      gap: 20px;
      align-items: center;
    }
    
    .signup-footer-link {
      font-family: 'Inter', sans-serif;
      font-weight: 400;
      font-size: 14px;
      line-height: 16.8px;
      color: #9ca3af;
      text-decoration: none;
      transition: color 0.2s;
    }
    
    .signup-footer-link:hover {
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="signup-main-content">
    <div class="signup-container">
      <div class="signup-header-section">
        <div class="signup-progress">
          <div class="signup-step signup-step-1"></div>
          <div class="signup-step signup-step-2"></div>
          <div class="signup-step signup-step-3"></div>
          <div class="signup-step signup-step-4"></div>
        </div>
        <p class="signup-title">사업자 회원가입</p>
        <p class="signup-description">개인정보와 회원정보를 입력해주세요.</p>
      </div>
      
      <div class="signup-form-section">
        <div class="signup-input-group">
          <p class="signup-label">이름</p>
          <input type="text" class="signup-input" id="name-input" placeholder="이름을 입력해주세요.">
        </div>
        
        <div class="signup-input-group">
          <div class="signup-label-row">
            <p class="signup-label">전화번호</p>
            <button type="button" class="signup-verify-button" id="verify-phone-btn">인증하기</button>
          </div>
          <input type="tel" class="signup-input" id="phone-input" placeholder="번호만 입력해주세요.">
          <div class="phone-verification-code-section" id="phone-verification-code-section" style="display: none;">
            <div class="signup-label-row">
              <p class="signup-label">인증번호</p>
              <button type="button" class="signup-verify-button" id="verify-code-btn">확인</button>
            </div>
            <input type="text" class="signup-input" id="phone-verification-code-input" placeholder="번호만 입력해주세요." maxlength="6">
            <div class="phone-verification-timer-row">
              <span class="phone-verification-timer" id="phone-verification-timer">3:00</span>
              <button type="button" class="phone-verification-resend" id="phone-verification-resend">재전송</button>
            </div>
          </div>
          <p class="signup-error-message" id="phone-error-message"></p>
        </div>
        
        <div class="signup-input-group">
          <div class="signup-label-row">
            <p class="signup-label">아이디</p>
            <button type="button" class="signup-verify-button" id="verify-id-btn">인증하기</button>
          </div>
          <input type="text" class="signup-input" id="login-id-input" placeholder=" 5~20자, 영문 소문자, 숫자, ( _ ), ( - ) 만 가능">
          <p class="signup-error-message" id="id-error-message"></p>
        </div>
        
        <div class="signup-input-group">
          <p class="signup-label">비밀번호</p>
          <div class="password-input-wrapper">
            <input type="password" class="signup-input" id="password-input" placeholder="8~16자의 영문 대/소문자, 숫자, 특수문자">
            <button type="button" class="password-toggle-button" id="password-toggle-btn">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="eye-icon">
                <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="eye-off-icon" style="display: none;">
                <path d="M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.6819 3.96914 7.65661 6.06 6.06M9.9 4.24C10.5883 4.0789 11.2931 3.99836 12 4C19 4 23 12 23 12C22.393 13.1356 21.6691 14.2047 20.84 15.19M14.12 14.12C13.8454 14.4147 13.5141 14.6512 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.4811 9.80385 14.1962C9.51897 13.9113 9.29439 13.572 9.14351 13.1984C8.99262 12.8248 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02091 11.2218 9.18488 10.8538C9.34884 10.4858 9.58525 10.1546 9.88 9.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <p class="signup-error-message" id="password-error-message"></p>
        </div>
        
        <div class="signup-input-group">
          <p class="signup-label">비밀번호 확인</p>
          <div class="password-input-wrapper">
            <input type="password" class="signup-input" id="password-confirm-input" placeholder="번호만 입력해주세요.">
            <button type="button" class="password-toggle-button" id="password-confirm-toggle-btn">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="eye-icon">
                <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="eye-off-icon" style="display: none;">
                <path d="M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.6819 3.96914 7.65661 6.06 6.06M9.9 4.24C10.5883 4.0789 11.2931 3.99836 12 4C19 4 23 12 23 12C22.393 13.1356 21.6691 14.2047 20.84 15.19M14.12 14.12C13.8454 14.4147 13.5141 14.6512 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.4811 9.80385 14.1962C9.51897 13.9113 9.29439 13.572 9.14351 13.1984C8.99262 12.8248 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02091 11.2218 9.18488 10.8538C9.34884 10.4858 9.58525 10.1546 9.88 9.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <p class="signup-error-message" id="password-confirm-error-message"></p>
        </div>
        
        <button type="button" class="signup-submit-button" id="signup-submit-button" disabled>
          다음 단계로
        </button>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const nameInput = document.getElementById('name-input');
      const phoneInput = document.getElementById('phone-input');
      const loginIdInput = document.getElementById('login-id-input');
      const passwordInput = document.getElementById('password-input');
      const passwordConfirmInput = document.getElementById('password-confirm-input');
      const submitButton = document.getElementById('signup-submit-button');
      const verifyIdButton = document.getElementById('verify-id-btn');
      const verifyPhoneButton = document.getElementById('verify-phone-btn');
      const verifyCodeButton = document.getElementById('verify-code-btn');
      const phoneVerificationCodeSection = document.getElementById('phone-verification-code-section');
      const phoneVerificationCodeInput = document.getElementById('phone-verification-code-input');
      const phoneVerificationTimer = document.getElementById('phone-verification-timer');
      const phoneVerificationResend = document.getElementById('phone-verification-resend');
      
      const idErrorMessage = document.getElementById('id-error-message');
      const passwordErrorMessage = document.getElementById('password-error-message');
      const passwordConfirmErrorMessage = document.getElementById('password-confirm-error-message');
      const phoneErrorMessage = document.getElementById('phone-error-message');
      
      let isIdVerified = false;
      let isIdAvailable = false;
      let isPhoneVerified = false;
      let phoneVerificationTimerInterval = null;
      let phoneVerificationTimeLeft = 180; // 3분 = 180초
      
      // 회원가입 페이지가 아닌 곳에서 온 경우 데이터 삭제
      const referrer = document.referrer;
      const isFromSignupPage = referrer.includes('signup') || referrer.includes('notification-settings');
      
      if (!isFromSignupPage && referrer) {
        // 회원가입 페이지가 아닌 곳에서 온 경우 모든 회원가입 데이터 삭제
        localStorage.removeItem('signup_step1_data');
        localStorage.removeItem('signup_step2_data');
        localStorage.removeItem('signup_step3_data');
        localStorage.removeItem('notificationSettings');
      }
      
      // Step 3 저장된 데이터 불러오기
      const savedStep3Data = localStorage.getItem('signup_step3_data');
      if (savedStep3Data) {
        try {
          const step3Data = JSON.parse(savedStep3Data);
          if (step3Data.name) {
            nameInput.value = step3Data.name;
          }
          if (step3Data.phoneNumber) {
            phoneInput.value = step3Data.phoneNumber;
          }
          if (step3Data.loginId) {
            loginIdInput.value = step3Data.loginId;
            // 인증된 상태로 복원 (메시지만 표시)
            idErrorMessage.textContent = '사용 가능한 아이디입니다.';
            idErrorMessage.style.color = '#10b981'; // 초록색
            idErrorMessage.classList.add('visible');
            isIdVerified = true;
            isIdAvailable = true;
          }
          if (step3Data.password) {
            passwordInput.value = step3Data.password;
            passwordConfirmInput.value = step3Data.password;
          }
          // 데이터 로드 후 버튼 상태 업데이트
          updateSubmitButton();
        } catch (e) {
          console.error('Error loading step 3 data:', e);
        }
      }
      
      function updateSubmitButton() {
        const name = nameInput.value.trim();
        const phone = phoneInput.value.trim();
        const loginId = loginIdInput.value.trim();
        const password = passwordInput.value.trim();
        const passwordConfirm = passwordConfirmInput.value.trim();
        
        // 비밀번호 양식 검증
        const isPasswordValid = validatePassword(password);
        
        // 비밀번호 확인 일치 여부
        const isPasswordMatch = password === passwordConfirm;
        
        if (name && phone && loginId && password && passwordConfirm && 
            isIdVerified && isIdAvailable && isPhoneVerified && 
            isPasswordValid && isPasswordMatch) {
          submitButton.disabled = false;
        } else {
          submitButton.disabled = true;
        }
      }
      
      function updateVerifyButton() {
        const loginId = loginIdInput.value.trim();
        if (loginId.length > 0) {
          verifyIdButton.classList.add('active');
        } else {
          verifyIdButton.classList.remove('active');
        }
      }
      
      function updatePhoneVerifyButton() {
        const phone = phoneInput.value.trim();
        if (phone.length > 0) {
          verifyPhoneButton.classList.add('active');
        } else {
          verifyPhoneButton.classList.remove('active');
        }
      }
      
      function updateCodeVerifyButton() {
        const code = phoneVerificationCodeInput.value.trim();
        if (code.length > 0) {
          verifyCodeButton.classList.add('active');
        } else {
          verifyCodeButton.classList.remove('active');
        }
      }
      
      function validateLoginId(id) {
        // 5~20자, 영문 소문자, 숫자, _, - 만 가능
        const regex = /^[a-z0-9_-]{5,20}$/;
        return regex.test(id);
      }
      
      function validatePassword(password) {
        // 8~16자의 영문 대/소문자, 숫자, 특수문자
        const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,16}$/;
        return regex.test(password);
      }
      
      // 전화번호를 하이픈 형식으로 변환하는 함수
      function formatPhoneNumber(phoneNumber) {
        // 숫자만 추출
        const numbers = phoneNumber.replace(/[^0-9]/g, '');
        
        // 길이가 10자리 또는 11자리인지 확인
        if (numbers.length === 10) {
          // 10자리: 010-1234-5678 형식
          return numbers.replace(/(\d{3})(\d{3,4})(\d{4})/, '$1-$2-$3');
        } else if (numbers.length === 11) {
          // 11자리: 010-1234-5678 형식
          return numbers.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
        }
        
        // 이미 하이픈이 포함되어 있으면 그대로 반환
        if (phoneNumber.includes('-')) {
          return phoneNumber;
        }
        
        // 형식이 맞지 않으면 원본 반환 (서버에서 검증)
        return phoneNumber;
      }
      
      // 타이머 시작 함수
      function startPhoneVerificationTimer() {
        // 기존 타이머가 있으면 정리
        if (phoneVerificationTimerInterval) {
          clearInterval(phoneVerificationTimerInterval);
        }
        
        phoneVerificationTimeLeft = 180; // 3분 = 180초
        updatePhoneVerificationTimer();
        
        phoneVerificationTimerInterval = setInterval(() => {
          phoneVerificationTimeLeft--;
          updatePhoneVerificationTimer();
          
          if (phoneVerificationTimeLeft <= 0) {
            clearInterval(phoneVerificationTimerInterval);
            phoneVerificationTimerInterval = null;
          }
        }, 1000);
      }
      
      // 타이머 업데이트 함수
      function updatePhoneVerificationTimer() {
        const minutes = Math.floor(phoneVerificationTimeLeft / 60);
        const seconds = phoneVerificationTimeLeft % 60;
        const formattedTime = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        phoneVerificationTimer.textContent = formattedTime;
      }
      
      // 타이머 정리 함수
      function clearPhoneVerificationTimer() {
        if (phoneVerificationTimerInterval) {
          clearInterval(phoneVerificationTimerInterval);
          phoneVerificationTimerInterval = null;
        }
        phoneVerificationTimeLeft = 180;
        phoneVerificationTimer.textContent = '3:00';
      }
      
      nameInput.addEventListener('input', updateSubmitButton);
      phoneInput.addEventListener('input', function() {
        updateSubmitButton();
        updatePhoneVerifyButton();
      });
      
      // 인증코드 입력 시 확인 버튼 활성화
      phoneVerificationCodeInput.addEventListener('input', function() {
        updateCodeVerifyButton();
      });
      
      loginIdInput.addEventListener('input', function() {
        const loginId = this.value.trim();
        updateSubmitButton();
        updateVerifyButton();
        
        // 인증 상태 초기화
        isIdVerified = false;
        isIdAvailable = false;
        
        // Check for invalid characters in real-time
        if (loginId.length > 0) {
          // Check if contains invalid characters
          const invalidChars = /[^a-z0-9_-]/;
          if (invalidChars.test(loginId)) {
            idErrorMessage.textContent = '5~20자, 영문 소문자, 숫자, ( _ ), ( - ) 만 가능';
            idErrorMessage.style.color = '#ef4444'; // 빨간색
            idErrorMessage.classList.add('visible');
          } else if (loginId.length < 5 || loginId.length > 20) {
            idErrorMessage.textContent = '5~20자, 영문 소문자, 숫자, ( _ ), ( - ) 만 가능';
            idErrorMessage.style.color = '#ef4444'; // 빨간색
            idErrorMessage.classList.add('visible');
          } else {
            idErrorMessage.classList.remove('visible');
          }
        } else {
          idErrorMessage.classList.remove('visible');
        }
      });
      
      passwordInput.addEventListener('input', function() {
        updateSubmitButton();
        if (passwordInput.value.trim() && !validatePassword(passwordInput.value.trim())) {
          passwordErrorMessage.textContent = '비밀번호 양식을 확인해주세요.';
          passwordErrorMessage.classList.add('visible');
        } else {
          passwordErrorMessage.classList.remove('visible');
        }
      });
      
      passwordConfirmInput.addEventListener('input', function() {
        updateSubmitButton();
        if (passwordConfirmInput.value.trim() && passwordConfirmInput.value.trim() !== passwordInput.value.trim()) {
          passwordConfirmErrorMessage.textContent = '비밀번호와 일치하지 않습니다.';
          passwordConfirmErrorMessage.classList.add('visible');
        } else {
          passwordConfirmErrorMessage.classList.remove('visible');
        }
      });
      
      updateVerifyButton();
      updatePhoneVerifyButton();
      updateCodeVerifyButton();
      
      verifyIdButton.addEventListener('click', async function() {
        const loginId = loginIdInput.value.trim();
        
        if (!loginId) {
          alert('아이디를 입력해주세요.');
          return;
        }
        
        if (!validateLoginId(loginId)) {
          idErrorMessage.textContent = '5~20자, 영문 소문자, 숫자, ( _ ), ( - ) 만 가능';
          idErrorMessage.classList.add('visible');
          return;
        }
        
        try {
          const API_BASE_URL = window.CONFIG.API_BASE_URL;
          const checkLoginIdEndpoint = window.CONFIG.ENDPOINT.CHECK_LOGIN_ID;
          console.log('Calling API:', `${API_BASE_URL}${checkLoginIdEndpoint}`);
          console.log('Request body:', { loginId: loginId });
          
          const response = await fetch(`${API_BASE_URL}${checkLoginIdEndpoint}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              loginId: loginId
            }),
            credentials: 'include'
          });
          
          console.log('Response status:', response.status);
          console.log('Response ok:', response.ok);
          
          // 응답 본문 파싱
          let responseData;
          try {
            responseData = await response.json();
            console.log('Response data:', responseData);
          } catch (e) {
            console.log('Response is not JSON');
            responseData = {};
          }
          
          // available 필드 확인
          const isAvailable = responseData.available === true;
          
          if (response.ok && isAvailable) {
            // 아이디 사용 가능 (200 OK && available: true)
            isIdVerified = true;
            isIdAvailable = true;
            
            // 성공 메시지 표시 (초록색)
            idErrorMessage.textContent = '사용 가능한 아이디입니다.';
            idErrorMessage.style.color = '#10b981'; // 초록색
            idErrorMessage.classList.add('visible');
            
            // 텍스트 박스와 버튼은 그대로 유지
            updateSubmitButton();
          } else {
            // available: false이거나 200이 아닌 경우 (이미 사용중인 아이디 등)
            let errorMessage = '이미 사용중인 아이디입니다.';
            if (responseData.message) {
              errorMessage = responseData.message;
            }
            
            idErrorMessage.textContent = errorMessage;
            idErrorMessage.style.color = '#ef4444'; // 빨간색
            idErrorMessage.classList.add('visible');
          }
        } catch (error) {
          console.error('Error verifying login ID:', error);
          alert(`인증 중 오류가 발생했습니다: ${error.message}`);
        }
      });
      
      // 전화번호 인증하기 버튼 클릭 이벤트
      verifyPhoneButton.addEventListener('click', async function() {
        const phone = phoneInput.value.trim();
        
        if (!phone) {
          phoneErrorMessage.textContent = '전화번호를 입력해주세요.';
          phoneErrorMessage.classList.add('visible');
          return;
        }
        
        // 전화번호를 하이픈 형식으로 변환
        const formattedPhone = formatPhoneNumber(phone);
        
        const originalButtonHTML = verifyPhoneButton.innerHTML;
        verifyPhoneButton.disabled = true;
        verifyPhoneButton.innerHTML = '인증 중...';
        phoneErrorMessage.classList.remove('visible');
        
        // 인증 중일 때 텍스트박스 회색으로 변경
        phoneInput.classList.add('verified');
        phoneInput.disabled = true;
        
        try {
          const API_BASE_URL = window.CONFIG.API_BASE_URL;
          const phoneVerificationSendEndpoint = window.CONFIG.ENDPOINT.PHONE_VERIFICATION_SEND;
          console.log('Calling API:', `${API_BASE_URL}${phoneVerificationSendEndpoint}`);
          console.log('Request body:', { phoneNumber: formattedPhone });
          
          const response = await fetch(`${API_BASE_URL}${phoneVerificationSendEndpoint}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              phoneNumber: formattedPhone
            }),
            credentials: window.CONFIG?.USE_CREDENTIALS ? 'include' : 'omit'
          });
          
          console.log('Response status:', response.status);
          
          if (response.ok) {
            // 인증번호 전송 성공
            phoneInput.value = formattedPhone; // 하이픈 형식으로 업데이트
            
            // 인증 성공 시 텍스트박스 다시 활성화 (흰색으로)
            phoneInput.classList.remove('verified');
            phoneInput.disabled = false; // 인증번호 확인 전까지는 수정 가능
            
            // 인증번호 입력 필드 표시
            phoneVerificationCodeSection.style.display = 'flex';
            phoneVerificationCodeInput.focus();
            
            // 타이머 시작
            startPhoneVerificationTimer();
            
            // 인증번호 전송 성공 시 버튼은 그대로 유지 (인증번호 확인 성공 시에만 인증완료로 변경)
            verifyPhoneButton.disabled = false;
            updatePhoneVerifyButton();
          } else {
            // 에러 처리
            let errorMessage = '인증번호 전송에 실패했습니다.';
            try {
              const errorData = await response.json();
              console.log('Error response data:', errorData);
              errorMessage = errorData.message || errorMessage;
            } catch (e) {
              console.log('Error response is not JSON');
              errorMessage = `인증번호 전송에 실패했습니다. (상태 코드: ${response.status})`;
            }
            
            phoneErrorMessage.textContent = errorMessage;
            phoneErrorMessage.classList.add('visible');
            
            // 실패 시 텍스트박스 다시 활성화 (흰색으로)
            phoneInput.classList.remove('verified');
            phoneInput.disabled = false;
            
            verifyPhoneButton.disabled = false;
            verifyPhoneButton.innerHTML = originalButtonHTML;
            updatePhoneVerifyButton();
          }
        } catch (error) {
          console.error('Error sending phone verification:', error);
          phoneErrorMessage.textContent = `인증번호 전송 중 오류가 발생했습니다: ${error.message}`;
          phoneErrorMessage.classList.add('visible');
          
          // 오류 시 텍스트박스 다시 활성화 (흰색으로)
          phoneInput.classList.remove('verified');
          phoneInput.disabled = false;
          
          verifyPhoneButton.disabled = false;
          verifyPhoneButton.innerHTML = originalButtonHTML;
          updatePhoneVerifyButton();
        }
      });
      
      // 다시 받기 버튼 클릭 이벤트
      phoneVerificationResend.addEventListener('click', async function() {
        const phone = phoneInput.value.trim();
        
        if (!phone) {
          phoneErrorMessage.textContent = '전화번호를 입력해주세요.';
          phoneErrorMessage.classList.add('visible');
          return;
        }
        
        // 전화번호를 하이픈 형식으로 변환
        const formattedPhone = formatPhoneNumber(phone);
        
        phoneVerificationResend.disabled = true;
        phoneVerificationResend.textContent = '전송 중...';
        phoneErrorMessage.classList.remove('visible');
        
        try {
          const API_BASE_URL = window.CONFIG.API_BASE_URL;
          const phoneVerificationSendEndpoint = window.CONFIG.ENDPOINT.PHONE_VERIFICATION_SEND;
          
          const response = await fetch(`${API_BASE_URL}${phoneVerificationSendEndpoint}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              phoneNumber: formattedPhone
            }),
            credentials: window.CONFIG?.USE_CREDENTIALS ? 'include' : 'omit'
          });
          
          if (response.ok) {
            // 타이머 재시작
            startPhoneVerificationTimer();
            phoneVerificationCodeInput.value = '';
            phoneVerificationCodeInput.focus();
            phoneVerificationResend.disabled = false;
            phoneVerificationResend.textContent = '재전송';
          } else {
            let errorMessage = '인증번호 전송에 실패했습니다.';
            try {
              const errorData = await response.json();
              errorMessage = errorData.message || errorMessage;
            } catch (e) {
              errorMessage = `인증번호 전송에 실패했습니다. (상태 코드: ${response.status})`;
            }
            
            phoneErrorMessage.textContent = errorMessage;
            phoneErrorMessage.classList.add('visible');
            phoneVerificationResend.disabled = false;
            phoneVerificationResend.textContent = '재전송';
          }
        } catch (error) {
          console.error('Error resending phone verification:', error);
          phoneErrorMessage.textContent = `인증번호 전송 중 오류가 발생했습니다: ${error.message}`;
          phoneErrorMessage.classList.add('visible');
          phoneVerificationResend.disabled = false;
          phoneVerificationResend.textContent = '재전송';
        }
      });
      
      // 인증번호 확인 버튼 클릭 이벤트
      verifyCodeButton.addEventListener('click', async function() {
        const phone = phoneInput.value.trim();
        const verificationCode = phoneVerificationCodeInput.value.trim();
        
        if (!phone) {
          phoneErrorMessage.textContent = '전화번호를 입력해주세요.';
          phoneErrorMessage.classList.add('visible');
          return;
        }
        
        if (!verificationCode) {
          phoneErrorMessage.textContent = '인증번호를 입력해주세요.';
          phoneErrorMessage.classList.add('visible');
          return;
        }
        
        // 인증번호는 6자리 숫자여야 함
        if (!/^[0-9]{6}$/.test(verificationCode)) {
          phoneErrorMessage.textContent = '인증번호는 6자리 숫자입니다.';
          phoneErrorMessage.classList.add('visible');
          return;
        }
        
        // 전화번호를 하이픈 형식으로 변환
        const formattedPhone = formatPhoneNumber(phone);
        
        const originalButtonHTML = verifyCodeButton.innerHTML;
        verifyCodeButton.disabled = true;
        verifyCodeButton.innerHTML = '확인 중...';
        phoneErrorMessage.classList.remove('visible');
        
        try {
          const API_BASE_URL = window.CONFIG.API_BASE_URL;
          const phoneVerificationConfirmEndpoint = window.CONFIG.ENDPOINT.PHONE_VERIFICATION_CONFIRM;
          console.log('Calling API:', `${API_BASE_URL}${phoneVerificationConfirmEndpoint}`);
          console.log('Request body:', { phoneNumber: formattedPhone, verificationCode: verificationCode });
          
          const response = await fetch(`${API_BASE_URL}${phoneVerificationConfirmEndpoint}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              phoneNumber: formattedPhone,
              verificationCode: verificationCode
            }),
            credentials: window.CONFIG?.USE_CREDENTIALS ? 'include' : 'omit'
          });
          
          console.log('Response status:', response.status);
          
          // 응답 본문 파싱
          let responseData;
          try {
            responseData = await response.json();
            console.log('Response data:', responseData);
          } catch (e) {
            console.log('Response is not JSON');
            responseData = {};
          }
          
          // verified 필드 확인 (응답 본문에 verified 필드가 있으면 우선 확인)
          const isVerified = responseData.verified === true;
          
          if (response.ok && isVerified) {
            // 인증번호 확인 성공
            isPhoneVerified = true;
            phoneVerificationCodeInput.classList.add('verified');
            phoneVerificationCodeInput.disabled = true;
            
            // 전화번호 입력 필드도 인증완료 상태로 변경 (회색 배경)
            phoneInput.classList.add('verified');
            phoneInput.disabled = true;
            
            // 타이머 정리
            clearPhoneVerificationTimer();
            
            // 타이머와 재전송 버튼 숨기기
            const timerRow = document.querySelector('.phone-verification-timer-row');
            if (timerRow) {
              timerRow.style.display = 'none';
            }
            
            // 인증번호 확인 버튼 상태 변경
            verifyCodeButton.classList.remove('active');
            verifyCodeButton.classList.add('verified');
            verifyCodeButton.innerHTML = `
              <div class="verify-check-icon">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 14L12.5 17.5L19 11" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <span class="verify-text">인증완료</span>
            `;
            verifyCodeButton.disabled = true;
            
            // 전화번호 인증하기 버튼도 인증완료 상태로 변경
            if (!verifyPhoneButton.classList.contains('verified')) {
              verifyPhoneButton.classList.remove('active');
              verifyPhoneButton.classList.add('verified');
              verifyPhoneButton.innerHTML = `
                <div class="verify-check-icon">
                  <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 14L12.5 17.5L19 11" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="verify-text">인증완료</span>
              `;
              verifyPhoneButton.disabled = true;
            }
            
            // 성공 메시지는 표시하지 않음
            phoneErrorMessage.textContent = '';
            phoneErrorMessage.classList.remove('visible');
            updateSubmitButton();
          } else {
            // 실패 메시지 표시
            let errorMessage = '인증번호가 일치하지 않습니다.';
            if (responseData.message) {
              errorMessage = responseData.message;
            }
            
            phoneErrorMessage.textContent = errorMessage;
            phoneErrorMessage.style.color = '#dc2626'; // 에러 색상 (빨간색)
            phoneErrorMessage.classList.add('visible');
            verifyCodeButton.disabled = false;
            verifyCodeButton.innerHTML = originalButtonHTML;
            updateCodeVerifyButton();
          }
        } catch (error) {
          console.error('Error confirming phone verification:', error);
          phoneErrorMessage.textContent = '인증번호 확인에 실패했습니다.';
          phoneErrorMessage.style.color = '#dc2626'; // 에러 색상 (빨간색)
          phoneErrorMessage.classList.add('visible');
          verifyCodeButton.disabled = false;
          verifyCodeButton.innerHTML = originalButtonHTML;
          updateCodeVerifyButton();
        }
      });
      
      submitButton.addEventListener('click', function() {
        if (!submitButton.disabled) {
          // Step 3 데이터 저장
          const signupData = {
            name: nameInput.value.trim(),
            phoneNumber: phoneInput.value.trim(),
            loginId: loginIdInput.value.trim(),
            password: passwordInput.value.trim()
          };
          localStorage.setItem('signup_step3_data', JSON.stringify(signupData));
          
          // Navigate to notification settings page (step 4)
          window.location.href = 'signup-step4.html';
        }
      });
      
      // 비밀번호 보기/숨기기 토글
      const passwordToggleBtn = document.getElementById('password-toggle-btn');
      const passwordConfirmToggleBtn = document.getElementById('password-confirm-toggle-btn');
      
      if (passwordToggleBtn) {
        passwordToggleBtn.addEventListener('click', function() {
          const eyeIcon = this.querySelector('.eye-icon');
          const eyeOffIcon = this.querySelector('.eye-off-icon');
          
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.style.display = 'none';
            eyeOffIcon.style.display = 'block';
          } else {
            passwordInput.type = 'password';
            eyeIcon.style.display = 'block';
            eyeOffIcon.style.display = 'none';
          }
        });
      }
      
      if (passwordConfirmToggleBtn) {
        passwordConfirmToggleBtn.addEventListener('click', function() {
          const eyeIcon = this.querySelector('.eye-icon');
          const eyeOffIcon = this.querySelector('.eye-off-icon');
          
          if (passwordConfirmInput.type === 'password') {
            passwordConfirmInput.type = 'text';
            eyeIcon.style.display = 'none';
            eyeOffIcon.style.display = 'block';
          } else {
            passwordConfirmInput.type = 'password';
            eyeIcon.style.display = 'block';
            eyeOffIcon.style.display = 'none';
          }
        });
      }
    });
  </script>

  <!-- Footer -->
  <div class="signup-footer-section">
    <div class="signup-footer-links">
      <a href="#" class="signup-footer-link">이용약관</a>
      <a href="#" class="signup-footer-link">개인정보처리방침</a>
      <a href="#" class="signup-footer-link">고객센터</a>
    </div>
  </div>
</body>
</html>

